name: terraform

on:
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  terraform:
    environment: production
    name: deployment
    runs-on: ubuntu-latest

    defaults:
      run:
        shell: bash

    steps:
      - name: Install GitHub Actions@v3 actions/checkout@v3
        uses: actions/checkout@v3

      - name: Install Terraform@v1 hashicorp/setup-terraform@v1
        uses: hashicorp/setup-terraform@v1
        with:
          cli_config_credentials_token: ${{ secrets.TF_API_TOKEN }}

      - name: Terraform initialize Terraform@v1
        run: |
          terraform init \
          -backend=false \
          -input=false \
          -no-color \
          -reconfigure

      - name: Terraform format Terraform@v1
        run: |
          terraform fmt \
          -check \
          -list=false \
          -no-color \
          -recursive \
          -write=false
